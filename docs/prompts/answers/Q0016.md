# Q0016: Flutter에서 기능 테스트와 화면 테스트를 위한 테스트 코드 작성

**날짜**: 2026-02-28
**원본**: [PROPMTS.md](../PROPMTS.md#q0016)

## 질문

1. 기능 테스트, 화면 테스트를 위한 테스트 코드 작성 요령
2. 각각 테스트 코드는 어디에 위치시키는지

## 답변

### 1. Flutter 테스트의 3가지 종류

Flutter는 테스트를 3가지로 분류해.

| 종류 | 대상 | 속도 | 비용 |
|---|---|---|---|
| **Unit Test** | 함수, 클래스, UseCase, ViewModel | 빠름 | 낮음 |
| **Widget Test** | 개별 위젯, 화면 | 중간 | 중간 |
| **Integration Test** | 앱 전체 흐름 | 느림 | 높음 |

이 프로젝트 기준으로는 **Unit Test + Widget Test** 조합이 핵심이야.

---

### 2. 파일 위치

```
test/
├── domain/
│   └── usecases/
│       └── calculate_result_use_case_test.dart   # UseCase 단위 테스트
├── presentation/
│   ├── calculator/
│   │   ├── basic_calculator_viewmodel_test.dart  # ViewModel 단위 테스트
│   │   └── basic_calculator_screen_test.dart     # 화면 Widget 테스트
│   └── currency/
│       └── currency_screen_test.dart
└── data/
    └── repositories/
        └── exchange_rate_repository_test.dart
```

`test/` 디렉토리는 `lib/`과 **같은 구조로 미러링**하는 게 관례야.

---

### 3. 기능 테스트 (Unit Test)

UseCase나 ViewModel의 로직을 검증해.

**UseCase 테스트 예시**
```dart
// test/domain/usecases/calculate_result_use_case_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:calcmate/domain/usecases/calculate_result_use_case.dart';

void main() {
  late CalculateResultUseCase useCase;

  setUp(() {
    useCase = CalculateResultUseCase();
  });

  group('CalculateResultUseCase', () {
    test('덧셈이 정상적으로 계산된다', () {
      final result = useCase.execute('3 + 5');
      expect(result, 8.0);
    });

    test('0으로 나누면 예외를 던진다', () {
      expect(() => useCase.execute('5 / 0'), throwsA(isA<DivisionByZeroException>()));
    });
  });
}
```

**ViewModel 테스트 예시 (Riverpod)**
```dart
// test/presentation/calculator/basic_calculator_viewmodel_test.dart
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:calcmate/presentation/calculator/basic_calculator_viewmodel.dart';

void main() {
  test('숫자 입력 시 display가 업데이트된다', () {
    final container = ProviderContainer();
    addTearDown(container.dispose);

    final notifier = container.read(basicCalculatorViewModelProvider.notifier);

    notifier.handleIntent(const CalculatorIntent.inputDigit('5'));

    final state = container.read(basicCalculatorViewModelProvider);
    expect(state.display, '5');
  });
}
```

---

### 4. 화면 테스트 (Widget Test)

UI가 올바르게 렌더링되고 사용자 인터랙션에 반응하는지 검증해.

```dart
// test/presentation/calculator/basic_calculator_screen_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:calcmate/presentation/calculator/basic_calculator_screen.dart';

void main() {
  testWidgets('계산기 버튼 탭 시 display에 숫자가 표시된다', (tester) async {
    await tester.pumpWidget(
      const ProviderScope(
        child: MaterialApp(
          home: BasicCalculatorScreen(),
        ),
      ),
    );

    // 버튼 탭
    await tester.tap(find.text('5'));
    await tester.pump();

    // display에 '5'가 보이는지 확인
    expect(find.text('5'), findsWidgets);
  });

  testWidgets('= 버튼 탭 시 결과가 표시된다', (tester) async {
    await tester.pumpWidget(
      const ProviderScope(
        child: MaterialApp(home: BasicCalculatorScreen()),
      ),
    );

    await tester.tap(find.text('3'));
    await tester.pump();
    await tester.tap(find.text('+'));
    await tester.pump();
    await tester.tap(find.text('4'));
    await tester.pump();
    await tester.tap(find.text('='));
    await tester.pump();

    expect(find.text('7'), findsOneWidget);
  });
}
```

---

### 5. 테스트 실행 명령어

```bash
# 전체 테스트 실행
flutter test

# 특정 파일만
flutter test test/domain/usecases/calculate_result_use_case_test.dart

# 특정 디렉토리만
flutter test test/presentation/

# 커버리지 확인
flutter test --coverage
```

---

### 6. 이 프로젝트에서의 권장 전략

- **Unit Test**: UseCase, ViewModel — 로직이 있는 모든 클래스에 작성
- **Widget Test**: 각 화면의 핵심 인터랙션만 커버 (버튼 탭, 결과 표시)
- **Integration Test**: 일단 생략 — 앱 규모가 커지면 추가
- **TDD 원칙** (CLAUDE.md에 명시됨): 로직 구현 전 Unit Test 먼저 작성
