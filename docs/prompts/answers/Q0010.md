# Q0010: Riverpod ProviderScope 개념 및 설정

**날짜**: 2026-02-27
**원본**: [PROPMTS.md](../PROPMTS.md#q0010)

## 질문

Riverpod ProviderScope에 대한 개념 설명 및 이 프로젝트에서의 활용 방법

## 답변

### 핵심 개념 한 줄 요약

> **ProviderScope = 앱 전체에서 공유되는 상태(Provider)를 담는 그릇**

---

### 배경: 왜 필요한가?

Flutter는 위젯 트리 구조입니다. 어떤 화면에서든 상태에 접근하려면 그 상태를 **트리 최상단**에 놓아야 합니다.

```
ProviderScope          ← 여기서 모든 Provider를 관리
  └─ MaterialApp
       └─ MainScreen
            ├─ CalcModeCard
            └─ CalculatorScreen
                  └─ CalculatorViewModel  ← 어디서든 Provider 접근 가능
```

---

### Provider란?

Riverpod에서 상태/로직의 단위입니다. 종류는 여러 개지만 이 프로젝트에서 주로 쓸 것은:

| Provider 종류 | 용도 |
|---|---|
| `Provider` | 읽기 전용 값 (Dio 인스턴스 등) |
| `NotifierProvider` | 상태 + 액션이 있는 ViewModel |
| `AsyncNotifierProvider` | 비동기 상태 (API 호출 등) |

```dart
// 예: Dio 인스턴스를 앱 전체에서 공유
final dioProvider = Provider<Dio>((ref) => Dio());

// 어느 위젯에서든 ref.read(dioProvider)로 접근 가능
```

---

### ProviderScope 역할

```dart
void main() {
  runApp(
    ProviderScope(        // ← 이 안에서만 Provider 사용 가능
      child: MyApp(),
    ),
  );
}
```

- **Provider 컨테이너**: 모든 Provider의 인스턴스를 생성·보관
- **생명주기 관리**: 위젯이 사라지면 Provider도 자동 정리
- **테스트 격리**: 테스트마다 별도 ProviderScope로 깔끔하게 격리 가능

---

### ConsumerWidget: Provider를 구독하는 위젯

일반 `StatelessWidget` 대신 `ConsumerWidget`을 사용하면 `ref`를 통해 Provider에 접근할 수 있습니다.

```dart
// 일반 위젯 (Provider 접근 불가)
class MyWidget extends StatelessWidget {
  Widget build(BuildContext context) { ... }
}

// ConsumerWidget (Provider 접근 가능)
class MyWidget extends ConsumerWidget {
  Widget build(BuildContext context, WidgetRef ref) {
    final state = ref.watch(calculatorViewModelProvider); // 구독
    return Text(state.result);
  }
}
```

`ref` 사용법:
| 메서드 | 용도 |
|---|---|
| `ref.watch(provider)` | 상태 구독 — 값 바뀌면 위젯 재빌드 |
| `ref.read(provider)` | 1회 읽기 — 이벤트 핸들러 내에서 사용 |
| `ref.listen(provider, ...)` | 상태 변화 감지 — 스낵바, 다이얼로그 등 |

---

### 이 프로젝트에서의 구조

```
lib/
├── main.dart                          # ProviderScope 래핑
├── core/
│   └── di/
│       └── providers.dart             # 공통 Provider 정의
│           ├─ dioProvider             # Dio 인스턴스
│           └─ (추후 Repository 등)
└── presentation/
    ├── main/
    │   └── main_screen_viewmodel.dart # NotifierProvider — 카드 리스트
    └── calculator/
        └── calculator_viewmodel.dart  # NotifierProvider — 계산기 상태
```

```dart
// core/di/providers.dart
final dioProvider = Provider<Dio>((ref) {
  return Dio(BaseOptions(
    connectTimeout: const Duration(seconds: 10),
    receiveTimeout: const Duration(seconds: 10),
  ));
});
```

```dart
// main.dart
void main() {
  runApp(
    const ProviderScope(
      child: CalcMateApp(),
    ),
  );
}
```
